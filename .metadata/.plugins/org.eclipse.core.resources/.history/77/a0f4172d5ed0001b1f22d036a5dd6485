package com.nashtechglobal.service;

import com.nashtechglobal.datamodel.Post;

import java.io.File;
import java.io.IOException;
import java.nio.file.Files;
import java.time.LocalDate;
import java.time.format.DateTimeFormatter;
import java.util.ArrayList;
import java.util.List;
import java.util.stream.Collectors;
import java.util.stream.Stream;

public class FileReaderService {
    public List<Post> readFile(String filePath) {
        try (Stream<String> lines = Files.lines(new File(filePath).toPath())) {
            return lines.skip(1).map(this::convertLineToPost).collect(Collectors.toList());
        } catch (IOException ex) {
            ex.printStackTrace();
            return new ArrayList<>();
        }
    }

    public Post convertLineToPost(String line) {
        String[] values = line.split("\\|");

        Post post = new Post();
        post.setAuthor(values[0]);
        post.setTitle(values[1]);
        post.setDescription((values[2]));
        post.setContent(values[3]);
        post.setDate(LocalDate.parse(values[4], DateTimeFormatter.ofPattern("yyyyMMdd")));

        return post;
    }
}
